<odoo>
    <template id="rubbertest_report_template">
        <!-- Use correct external layout in report -->
        <t t-call="web.html_container">
            <t t-set="disable_header" t-value="True"/>
            <t t-set="disable_logo" t-value="True"/>
            <t t-set="disable_commercial_header" t-value="True"/>
            <div class="page" style="font-size: 13px;">
                <h2>Theo dõi mũ thí nghiệm</h2>
                <form action="/report/html/caosu.rubbertest_report_template" method="get">
                    <div style="display: flex; gap: 20px;">
                        <div style="flex: 1;">
                            <div style="margin-bottom: 10px;">
                                <label for="to">Tổ:</label>
                                <select name="to" id="to">
                                    <option value="">-- All --</option>
                                    <t t-raw="to_options_html"/>
                                </select>
                            </div>
                            <div style="margin-bottom: 10px;">
                                <label for="lo">Lô:</label>
                                <select name="lo" id="lo">
                                    <t t-raw="lo_options_html"/>
                                </select>
                            </div>
                            <div style="margin-bottom: 10px;">
                                <label for="dao_kt_up">Dao KT:</label>
                                <select name="dao_kt_up" id="dao_kt_up">
                                    <t t-raw="dao_options_html"/>
                                </select>
                            </div>
                        </div>
                        
                        <div style="flex: 1;">
                            <div style="margin-bottom: 10px;">
                                <label for="nhom">Nhóm:</label>
                                <select name="nhom" id="nhom">
                                    <t t-raw="nhom_options_html"/>
                                </select>
                            </div>
                            <div style="margin-bottom: 10px;">
                                <label for="compare_field">Compare:</label>
                                <select name="compare_field" id="compare_field">
                                    <t t-raw="compare_options_html"/>
                                </select>
                            </div>
                            <div style="margin-bottom: 10px;">
                                <label for="detail_field">Detail:</label>
                                <select name="detail_field" id="detail_field">
                                    <t t-raw="detail_options_html"/>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div style="text-align: left; margin-top: 5px;">
                        <button type="submit" class="btn btn-primary">Xem kết quả</button>
                    </div>
                </form>
                <br/>
                <table class="table table-sm o_list_view" style="border-collapse: collapse;">
                    <thead>
                        <tr style="text-align: center; position: sticky; top: 0; background: #f2f2f2; z-index: 2;">
                            <th style="width: 40px; text-align: center; border-right: 0.5px solid #ccc; position: sticky; left: 0; background: #f2f2f2; z-index: 3;">
                                Cây
                            </th>
                            <t t-foreach="cols" t-as="col">
                                <th style="text-align: center; border-right: 0.5px solid #ccc; width:30px;">
                                    <t t-esc="col['name']"/>
                                </th>
                            </t>
                        </tr>
                        <tr style="text-align: center; font-weight: normal; border-bottom: 1.5px solid #ccc; position: sticky; top: 30px; background: #fff; z-index: 2;">
                            <td style="width:40px; border-right: 0.5px solid #ccc; border-bottom: 1.5px solid #ccc; position: sticky; left: 0; background: #f2f2f2; z-index: 3;">
                                Vanh
                            </td>
                            <t t-foreach="cols" t-as="col">
                                <td style="text-align: center; border-right: 0.5px solid #ccc; border-bottom: 1.5px solid black; width:30px;" 
                                    t-esc="col['vanhcay'] or '-'"/>
                            </t>
                        </tr>
                    </thead>
                    <tbody>
                        <t t-foreach="docs" t-as="group">
                            <!-- Primary Row -->
                            <tr>
                                <td style="width:40px; white-space: nowrap; text-align: center; border-right: 1.5px solid black; position: sticky; left: 0; background: #f2f2f2; z-index: 1;" 
                                    t-esc="group.get('name')"/>
                                <t t-foreach="cols" t-as="col">
                                    <td style="border-right: 0.5px solid #ccc; width:30px;">
                                        <t t-set="cell" t-value="group.get('group_values', {}).get(col['id'], {})"/>
                                        <div style="text-align: center; padding: 5px;"
                                            t-att-style="'background-color:' + (cell.get('background') or '')">
                                            <t t-if="cell.get('kichthich')">
                                                <span style="font-weight: bold; display: block; text-align: center;">
                                                    <t t-esc="cell.get('value') if cell.get('value') not in [0, '', None] else '-'"/>
                                                </span>
                                            </t>
                                            <t t-else="">
                                                <span style="display: block; text-align: center; font-family: 'Courier New', monospace;">
                                                    <t t-esc="cell.get('value') if cell.get('value') not in [0, '', None] else '-'"/>
                                                </span>
                                            </t>
                                        </div>
                                    </td>
                                </t>
                            </tr>
                            <!-- Optional Detail Row -->
                            <t t-if="detail_field != 'none' and detail_field != 'kichthich'">
                                <tr>
                                    <td style="width: 40px; white-space: nowrap; font-style: italic; text-align: center; border-right: 0.5px solid #ccc; position: sticky; left: 0; background: #f2f2f2; z-index: 1;">
                                        <t t-esc="detail_field_label"/>
                                    </td>
                                    <t t-foreach="cols" t-as="col">
                                        <td style="border-right: 0.5px solid #ccc; width:30px;">
                                            <div style="text-align: center; padding: 5px;">
                                                <t t-set="detail_cell" t-value="group.get('group_detail_values', {}).get(col['id'], {})"/>
                                                <span style="display: block; text-align: center; font-family: 'Courier New', monospace;">
                                                    <t t-esc="detail_cell.get('value') if detail_cell.get('value') not in [0, '', None] else '-'"/>
                                                </span>
                                            </div>
                                        </td>
                                    </t>
                                </tr>
                            </t>
                        </t>
                    </tbody>
                </table>
                <style>
                    @media screen and (max-width: 600px) {
                        .hide-mobile {
                            display: none !important;
                        }
                    }
                </style>
            </div>
        </t>
    </template>
</odoo>