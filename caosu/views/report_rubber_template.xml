<odoo>
    <template id="rubber_report_template">
        <!-- Use html_container like rubbertest does -->
        <t t-call="web.html_container">
            <t t-set="disable_header" t-value="True"/>
            <t t-set="disable_logo" t-value="True"/>
            <t t-set="disable_commercial_header" t-value="True"/>
            <div class="page" style="font-size: 13px;">
                <h2>THEO DÕI SẢN LƯỢNG CÔNG NHÂN</h2>
                <!-- Update form action to match rubbertest pattern -->
                <form action="/report/html/caosu.rubber_report_template" method="get">
                    <div style="display: flex; gap: 20px;">
                        <!-- Left column: to, lo, dao_kt -->
                        <div style="flex: 1;">
                            <div style="margin-bottom: 10px;">
                                <label for="to">Tổ:</label>
                                <select name="to" id="to">
                                    <option value="">-- All --</option>
                                    <t t-raw="to_options_html"/>
                                </select>
                            </div>
                            <div style="margin-bottom: 10px;">
                                <label for="lo">Lô:</label>
                                <select name="lo" id="lo">
                                    <t t-raw="lo_options_html"/>
                                </select>
                            </div>
                            <div style="margin-bottom: 10px;">
                                <label for="dao_kt">Dao KT:</label>
                                <select name="dao_kt" id="dao_kt">
                                    <t t-raw="dao_options_html"/>
                                </select>
                            </div>
                        </div>
                        
                        <!-- Right column: nhom, compare_field, detail_field -->
                        <div style="flex: 1;">
                            <div style="margin-bottom: 10px;">
                                <label for="nhom">Nhóm:</label>
                                <select name="nhom" id="nhom">
                                    <t t-raw="nhom_options_html"/>
                                </select>
                            </div>
                            <div style="margin-bottom: 10px;">
                                <label for="compare_field">Mũ:</label>
                                <select name="compare_field" id="compare_field">
                                    <t t-raw="compare_options_html"/>
                                </select>
                            </div>
                            <div style="margin-bottom: 10px;">
                                <label for="detail_field">Độ:</label>
                                <select name="detail_field" id="detail_field">
                                    <t t-raw="detail_options_html"/>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div style="text-align: left; margin-top: 5px;">
                        <button type="submit" class="btn btn-primary">Xem kết quả</button>
                    </div>
                </form>
                <br/>
                <!--<p style="background-color: #f8f9fa; padding: 10px; border: 1px solid #ddd;">
                    Debug: selected_nhom=<t t-esc="selected_nhom"/> |
                    selected_to=<t t-esc="selected_to"/> | 
                    selected_to_int=<t t-esc="selected_to_int"/> | 
                    selected_lo=<t t-esc="selected_lo"/> |
                    compare_field=<t t-esc="compare_field"/> |
                    detail_field=<t t-esc="detail_field"/> |
                    dao_kt=<t t-esc="dao_kt"/> |
                    avai_to=<t t-esc="available_to"/> |
                    avai_lo=<t t-esc="available_lo"/> |
                    avai_dao=<t t-esc="available_dao"/> |
                </p>-->
                <table class="table table-sm o_list_view report-table" style="border-collapse: collapse;">
                    <thead>
                        <tr style="text-align: center; font-weight: bold; border-bottom: 1.5px solid #ccc; position: sticky; top: 30px; background: #fff; z-index: 2;">
                            <td style="width: 40px; border-right: 0.5px solid #ccc; border-bottom: 1.5px solid #ccc; position: sticky; left: 0; background: #f2f2f2; z-index: 3;">
                                STT
                            </td>
                            <t t-foreach="cols" t-as="col">
                                <td style="text-align: center; border-right: 0.5px solid #ccc; width:20px;">
                                    <t t-esc="col['name']"/>
                                </td>
                            </t>
                        </tr>
                        <tr style="text-align: center; position: sticky; top: 0; background: #f2f2f2; z-index: 2;">
                            <td style="width: 40px; border-right: 0.5px solid #ccc; border-bottom: 1.5px solid #ccc; position: sticky; left: 0; background: #f2f2f2; z-index: 3;">
                                TÊN
                            </td>
                            <t t-foreach="cols" t-as="col">
                                <td style="text-align: center; border-right: 0.5px solid #ccc; border-bottom: 1.5px solid black; width:20px;" 
                                    t-esc="col['CN'] or '-'"/>
                            </t>
                        </tr>
                    </thead>
                    <tbody>
                        <t t-foreach="docs" t-as="group">
                            <!-- Primary Row -->
                            <tr>
                                <td style="width: 40px; white-space: nowrap; font-weight: bold; text-align: center; border-right: 1.5px solid black; position: sticky; left: 0; background: #f2f2f2; z-index: 1;" 
                                    t-esc="group.get('name')"/>
                                <t t-foreach="cols" t-as="col">
                                    <td style="border-right: 0.5px solid #ccc; width:20px;">
                                        <t t-set="cell" t-value="group.get('group_values', {}).get(col['id'], {})"/>
                                        <div style="text-align: center; padding: 5px;"
                                            t-att-style="'background-color:' + (cell.get('background') or '')">                                    
                                            <t t-if="cell.get('kichthich')">
                                                <span style="font-weight: bold; display: block; text-align: center; font-family: 'Courier New', monospace;">
                                                    <t t-esc="cell.get('value') if cell.get('value') not in [0, '', None] else '-'"/>
                                                </span>
                                            </t>
                                            <t t-else="">
                                                <span style="display: block; text-align: center; font-family: 'Courier New', monospace;">
                                                    <t t-esc="cell.get('value') if cell.get('value') not in [0, '', None] else '-'"/>
                                                </span>
                                            </t>
                                        </div>
                                    </td>
                                </t>
                            </tr>
                            <!-- Optional Detail Row (if detail_field != 'none' and not 'kichthich') -->
                            <t t-if="detail_field != 'none' and detail_field != 'kichthich'">
                                <tr>
                                    <td style="width: 40px; white-space: nowrap; font-style: italic; text-align: center; border-right: 0.5px solid #ccc; position: sticky; left: 0; background: #f2f2f2; z-index: 1;">
                                        <t t-esc="detail_field_label"/>
                                    </td>
                                    <t t-foreach="cols" t-as="col">
                                        <td style="border-right: 0.5px solid #ccc; width:20px;">
                                            <div style="text-align: center; padding: 5px;">
                                                <t t-set="detail_cell" t-value="group.get('group_detail_values', {}).get(col['id'], {})"/>
                                                <span class="detail-value" style="display: block; text-align: center;">
                                                    <t t-esc="detail_cell.get('value') if detail_cell.get('value') not in [0, '', None] else '-'"/>
                                                </span>
                                            </div>
                                        </td>
                                    </t>
                                </tr>
                            </t>
                        </t>
                    </tbody>
                </table>
                <!-- Move the style inside the template -->
                <style>
                    .report-table td {
                        font-size: 13px !important;
                        text-align: right;
                    }
                    .detail-value, .compare-value {
                        font-size: 13px !important;
                        white-space: nowrap;
                    }
                </style>
            </div>
        </t>
    </template>
    
</odoo>